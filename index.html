<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Care AI Trainer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            position: relative;
        }
        .header {
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
        .chat-container {
            height: 500px;
            overflow-y: auto;
            padding: 25px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }
        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            animation: fadeIn 0.3s ease;
        }
        .user-message { justify-content: flex-end; }
        .bot-message { justify-content: flex-start; }
        .message-bubble {
            max-width: 75%;
            padding: 15px 20px;
            border-radius: 18px;
            font-size: 16px;
            line-height: 1.5;
        }
        .user-bubble {
            background: #4f46e5;
            color: white;
            border-bottom-right-radius: 5px;
        }
        .bot-bubble {
            background: white;
            color: #333;
            border: 1px solid #e5e7eb;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .input-area {
            padding: 25px;
            background: white;
            display: flex;
            gap: 12px;
        }
        textarea {
            flex: 1;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            resize: none;
            font-family: inherit;
            transition: border 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: #4f46e5;
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 0 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        button:hover { background: #4338ca; }
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .loading { display: none; }
        .loading.active {
            display: inline-block;
            animation: spin 1s linear infinite;
        }
        .rules {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin: 20px;
            border-radius: 8px;
            font-size: 14px;
        }
        /* KEY POPUP STYLES */
        #keyPopup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .popup-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        .popup-box h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .key-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #4f46e5;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            font-family: monospace;
        }
        .save-btn {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .save-btn:hover { background: #4338ca; }
        .key-note {
            margin-top: 15px;
            font-size: 14px;
            color: #666;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media (max-width: 640px) {
            .container { border-radius: 0; }
            .message-bubble { max-width: 85%; }
            body { padding: 0; }
            .popup-box { padding: 25px; }
        }
    </style>
</head>
<body>
    <!-- KEY POPUP -->
    <div id="keyPopup">
        <div class="popup-box">
            <h3>ðŸ”‘ Enter Your OpenAI API Key</h3>
            <input type="password" id="keyInput" class="key-input" placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
            <button onclick="saveKey()" class="save-btn">Save & Start Training</button>
            <p class="key-note">Key is saved only in your browser â€¢ Never shared with anyone</p>
            <p class="key-note">Get key from: platform.openai.com/api-keys</p>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ðŸ¤– Customer Care AI Trainer</h1>
            <p>Practice professional customer support responses</p>
        </div>
        
        <div class="rules">
            <strong>AI Rules:</strong> Always polite â€¢ Never blame client â€¢ Explain clearly â€¢ Show empathy â€¢ End professionally
        </div>
        
        <div class="chat-container" id="chatContainer">
            <div class="message bot-message">
                <div class="message-bubble bot-bubble">
                    Hello! I'm your customer care training assistant. Enter your OpenAI API key to start.
                </div>
            </div>
        </div>
        
        <div class="input-area">
            <textarea 
                id="messageInput" 
                placeholder="Type or paste client message here... (Example: 'I want free plays now!')" 
                rows="3"
            ></textarea>
            <button id="sendButton" onclick="sendMessage()">
                <span>Send</span>
                <span class="loading" id="loading">âŸ³</span>
            </button>
        </div>
    </div>

    <script>
        // âœ… USER WILL ENTER KEY VIA POPUP
        let OPENAI_API_KEY = localStorage.getItem('customerCareKey') || '';
        
        // Show popup if no key
        if (!OPENAI_API_KEY) {
            document.getElementById('keyPopup').style.display = 'flex';
        }
        
        // Customer Care System Prompt (Your Rules)
        const SYSTEM_PROMPT = `You are a senior customer care agent. Follow these rules STRICTLY:
1. ALWAYS start with polite greeting
2. NEVER blame or argue with client
3. Explain policies clearly and patiently
4. If client asks for free plays, explain politely why not possible
5. Show empathy - acknowledge their frustration
6. End conversation professionally
7. Keep responses concise (3-4 lines max)

Example good reply: "Hello, thank you for contacting us. I understand your concern about free plays. Let me explain how our bonus system works so we can help you better."

Now respond to the client's message:`;

        const chatContainer = document.getElementById('chatContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const loading = document.getElementById('loading');

        // Load chat history
        let chatHistory = JSON.parse(localStorage.getItem('customerCareChat')) || [];
        if (chatHistory.length > 0) {
            chatHistory.forEach(msg => addMessage(msg.text, msg.role));
        }

        // Save key function
        function saveKey() {
            const key = document.getElementById('keyInput').value.trim();
            if (!key) {
                alert('Please enter your OpenAI API key');
                return;
            }
            if (!key.startsWith('sk-')) {
                alert('Invalid key format. Must start with "sk-"');
                return;
            }
            
            OPENAI_API_KEY = key;
            localStorage.setItem('customerCareKey', key);
            document.getElementById('keyPopup').style.display = 'none';
            
            // Update welcome message
            chatContainer.innerHTML = `<div class="message bot-message">
                <div class="message-bubble bot-bubble">
                    âœ… Key saved! I'm ready to help. Type any client message to practice professional responses.
                </div>
            </div>`;
            
            chatHistory = [];
            localStorage.setItem('customerCareChat', JSON.stringify(chatHistory));
            
            alert('âœ… Key saved successfully! You can now use the trainer.');
        }

        function addMessage(text, role) {
            const messageDiv = document.createElement('div');
            messageDiv.className = role === 'user' ? 'message user-message' : 'message bot-message';
            
            const bubble = document.createElement('div');
            bubble.className = role === 'user' ? 'message-bubble user-bubble' : 'message-bubble bot-bubble';
            bubble.textContent = text;
            
            messageDiv.appendChild(bubble);
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Save to history
            if (role === 'user' || role === 'assistant') {
                chatHistory.push({ text, role });
                localStorage.setItem('customerCareChat', JSON.stringify(chatHistory));
            }
        }

        async function sendMessage() {
            if (!OPENAI_API_KEY) {
                document.getElementById('keyPopup').style.display = 'flex';
                alert('Please enter your OpenAI API key first');
                return;
            }
            
            const userMessage = messageInput.value.trim();
            if (!userMessage) return;
            
            // Add user message
            addMessage(userMessage, 'user');
            messageInput.value = '';
            sendButton.disabled = true;
            loading.classList.add('active');
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${OPENAI_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            { role: 'system', content: SYSTEM_PROMPT },
                            { role: 'user', content: userMessage }
                        ],
                        temperature: 0.7,
                        max_tokens: 300
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                const aiReply = data.choices[0]?.message?.content || 
                               'Thank you for your message. How can I assist you?';
                
                addMessage(aiReply, 'assistant');
                
            } catch (error) {
                console.error('Error:', error);
                if (error.message.includes('401') || error.message.includes('403')) {
                    localStorage.removeItem('customerCareKey');
                    OPENAI_API_KEY = '';
                    document.getElementById('keyPopup').style.display = 'flex';
                    addMessage('âŒ Invalid or expired API key. Please enter a valid key.', 'assistant');
                } else {
                    addMessage('Sorry, I encountered an error. Please try again.', 'assistant');
                }
            } finally {
                sendButton.disabled = false;
                loading.classList.remove('active');
            }
        }

        // Enter key support
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Clear chat button
        function clearChat() {
            if (confirm('Clear all chat history?')) {
                chatHistory = [];
                localStorage.removeItem('customerCareChat');
                chatContainer.innerHTML = `<div class="message bot-message">
                    <div class="message-bubble bot-bubble">
                        Chat cleared. Ready for new practice session.
                    </div>
                </div>`;
            }
        }
    </script>
</body>
</html>
